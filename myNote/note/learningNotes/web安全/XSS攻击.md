# XSS（Cross SiteScript）

跨站脚本攻击；

恶意代码未经过滤，与正常网站混在一起被浏览器接收，导致浏览器无法区分而执行；

## 攻击类型

- 存储型XSS

存储在目标服务器上的恶意脚本。当浏览器请求数据时，脚本插入HTML一起从服务器传回并执行；



- 反射型XSS

通过链接或者表单携带恶意代码，当用户点击时，服务器从URL或表单中解析数据（实则为恶意代码），拼接在响应HTML数据中返回给浏览器，达到注入恶意脚本执行的目的；



- DOM型XSS

因为DOM环境变化导致恶意代码执行；

例：某些用户操作关联到innerHTML方法，而插入的内容未验证，直接将恶意代码插入页面，随即被解析执行；

同样可以用链接（字符本身）作为恶意代码的媒介；

DOM型XSS，与前两种的区别主要在于该过程并**不依赖服务器**；

## 防范

XSS攻击有两步骤：

1. 攻击者提交恶意代码
2. 浏览器执行恶意代码

防范第一步：

**输入过滤和转义**

对用户输入的特殊字符，如  ‘<’ ， '>'，'/'，等按照一定规则转义；

对于明确的输入类型，URL、电话、邮件等，进行严格的输入过滤；

对所有不信任的输入都进行长度限制；

> **注意：**
>
> 前端展示如果依赖用户输入，会因为转义而显示乱码； 
>
> 前端的输入过滤并不是可靠的方案，可通过直接构造请求绕过，只能作为辅助手段；



防范第二步：

**存储型和反射型XSS**都是服务器将恶意代码插入了正常的响应HTML文件，导致浏览器接收执行；

针对这点，有两种处理方式：

1. **对html文件中所有可能的插入点进行转义**

可插入点，如标签onclick的绑定事件、json.parse()参数、< a>标签的href属性值等；

在不同的环境需要采用不同的转义规则，可借助一些转义库处理；



2. **改为纯前端渲染，除了首次加载的静态html文件，服务器不返回html**

前端渲染时，可以明确指定要设置的内容，文本（innerText）、属性（setAttribute）、还是样式(style)等，避免浏览器执行意外脚本代码；

纯前端渲染通过AJAX加载数据，通过前端计算更改页面；目前流行的前端框架如Vue/React等多采用的前端渲染；

> 前端渲染要避免DOM型XSS，谨慎使用innerHTML、outerHTML、document.write()；
>
> vue的{{ }}、v-bind等指令会自动对内容进行转义（除了v-html，谨慎使用）；



**额外**

- 内容安全策略 CSP；

- cookie HttpOnly；